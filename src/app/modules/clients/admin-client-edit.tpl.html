<!-- Client Details -->
<form name="clientForm" ng-submit="saveClient()" id="admin_client_edit">

    <nav class="navbar navbar-fixed-top" id="preslog_sub_nav">
        <div class="navbar-inner">
            <div class="container-fluid">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>

                <h2>Edit Client</h2>

                <div class="nav-collapse collapse navbar-responsive-collapse">
                    <ul class="nav pull-right">
                        <li>
                            <button type="submit" class="btn btn-success"
                                    ng-disabled="clientForm.$invalid">
                                <i class="icon icon-ok"></i>
                                Save Changes
                            </button>
                            <button type="button" class="btn btn-danger"
                                    ng-click="deleteClient()"
                                    ng-show="{{client.id.length && !client.deleted}}"
                                    ng-confirm-click="Are you sure you want to delete this client? All users assigned to this client will be unable to access Preslog if you do this.">
                                <i class="icon icon-remove"></i>
                                Delete Client
                            </button>
                        </li>
                    </ul>
                </div><!-- /.nav-collapse -->
            </div>
        </div><!-- /navbar-inner -->
    </nav>

    <div class="container">
        <div class="span12">
            <div class="widget-box">
                <div class="widget-title">
                        <span class="widget-icon">
                            <i class="icon-user"></i>
                        </span>
                    <h3>Client Details</h3>
                </div>
                <div class="widget-content form-horizontal">

                    <!-- Company Name -->
                    <div class="control-group" ng-class="{error: clientForm.name.$dirty && clientForm.name.$invalid && clientForm.name.$dirty}">
                        <label class="control-label" for="inputName">Client Name</label>
                        <div class="controls">
                            <input type="text"
                                   id="inputName"
                                   name="name"
                                   placeholder="Company Name.."
                                   ng-model="client.name"
                                   required
                                   validate-server
                                    />
                            <span class="help-inline" ng-show="clientForm.name.$dirty && clientForm.name.$invalid && clientForm.name.$error.required">Must not be empty.</span>
                            <span class="help-inline" ng-show="clientForm.name.$dirty && clientForm.name.$invalid && clientForm.name.$error.validateServer" ng-bind="validation.name"></span>
                        </div>
                    </div>

                    <!-- Company Logo -->
                    <div class="control-group" ng-class="{error: clientForm.logo.$dirty && clientForm.logo.$invalid && clientForm.logo.$invalid}">

                        <label class="control-label" for="inputLogo"><span ng-show="client.id">Change </span>Logo</label>
                        <div class="controls">
                            <img ng-show="client._id" src="/assets/clients/{{ client._id }}.png" width="68" height="20" />
                            <br/>
                            <input type="file"
                                   id="inputLogo"
                                   name="logo"
                                   tooltip-placement="right"
                                   tooltip="Displayed on the Client Selection tab.
                                            Must be 68x20 pixel PNG."
                                    />
                            <span class="help-inline" ng-show="clientForm.logo.$dirty && clientForm.name.$invalid && clientForm.logo.$error.validateServer" ng-bind="validation.logo"></span>
                        </div>
                    </div>

                    <!-- Short-hand name -->
                    <div class="control-group" ng-class="{error: clientForm.shortName.$dirty && clientForm.shortName.$invalid && clientForm.shortName.$invalid}">
                        <label class="control-label" for="inputShortName">Short-hand Name</label>
                        <div class="controls">
                            <input type="text"
                                   id="inputShortName"
                                   name="shortName"
                                   placeholder="Short-hand Name.."
                                   ng-model="client.shortName"
                                   ng-maxlength="6"
                                   required
                                   validate-server
                                   tooltip-placement="right"
                                   tooltip="Short names are used in locations where space is at a premium, such as SMS notifications."
                            />
                            <span class="help-inline" ng-show="clientForm.shortName.$dirty && clientForm.shortName.$invalid && clientForm.shortName.$error.required">Must not be empty.</span>
                            <span class="help-inline" ng-show="clientForm.shortName.$dirty && clientForm.shortName.$invalid && clientForm.shortName.$error.maxlength">Must only contain up to 6 characters.</span>
                            <span class="help-inline" ng-show="clientForm.shortName.$dirty && clientForm.shortName.$invalid && clientForm.shortName.$error.validateServer" ng-bind="validation.shortName"></span>
                        </div>
                    </div>


                    <!-- Log Prefix -->
                    <div class="control-group" ng-class="{error: clientForm.logPrefix.$dirty && clientForm.logPrefix.$invalid && clientForm.logPrefix.$invalid}">
                        <label class="control-label" for="inputLogPrefix">Log Prefix</label>
                        <div class="controls">
                            <input type="text"
                                   id="inputLogPrefix"
                                   name="logPrefix"
                                   placeholder="Log Prefix (eg. P).."
                                   ng-model="client.logPrefix"
                                   required
                                   ng-pattern="/^[a-zA-Z]{1,6}$/"
                                   validate-server
                                   tooltip-placement="right"
                                   tooltip="The Log Prefix is attached to the beginning of all Log IDs."
                                    />
                            <span class="help-inline" ng-show="clientForm.logPrefix.$dirty && clientForm.logPrefix.$invalid && clientForm.logPrefix.$error.required">Must not be empty.</span>
                            <span class="help-inline" ng-show="clientForm.logPrefix.$dirty && clientForm.logPrefix.$invalid && clientForm.logPrefix.$error.pattern">May only contain up to 6 letters.</span>
                            <span class="help-inline" ng-show="clientForm.logPrefix.$dirty && clientForm.logPrefix.$invalid && clientForm.logPrefix.$error.validateServer" ng-bind="validation.logPrefix"></span>
                        </div>
                    </div>


                    <!-- Contact Details -->
                    <div class="control-group" ng-class="{error: clientForm.contact.$invalid}">
                        <label class="control-label" for="inputContact">Client Contact</label>
                        <div class="controls">
                            <textarea
                                    rows="4"
                                    id="inputContact"
                                    name="contact"
                                    ng-model="client.contact"
                                    ></textarea>
                            <span class="help-inline" ng-show="clientForm.contact.$dirty && clientForm.contact.$invalid && clientForm.contact.$error.validateServer" ng-bind="validation.contact"></span>
                        </div>
                    </div>

                    <!-- Activation Date -->
                    <div class="control-group" ng-class="{error: clientForm.activationDate.$dirty && clientForm.activationDate.$invalid && clientForm.activationDate.$invalid}">
                        <label class="control-label" for="inputActivationDate">Activation Date</label>
                        <div class="controls">
                            <input type="text"
                                   id="inputActivationDate"
                                   name="activationDate"
                                   placeholder="Click to select date.."
                                   ng-model="client.activationDate"
                                   required
                                   validate-server
                                   ng-pattern="/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/"
                                   tooltip-placement="right"
                                   tooltip="The Activation Date controls when this client will become accessible to users.
                                            Until the activation date has arrived, this client will only be visible to administrators.
                                            Any users assigned directly to an inactive client will not be able to login while the client is inactive."
                                    />
                            <span class="help-inline" ng-show="clientForm.activationDate.$dirty && clientForm.activationDate.$invalid && clientForm.activationDate.$error.required">Must not be empty.</span>
                            <span class="help-inline" ng-show="clientForm.activationDate.$dirty && clientForm.activationDate.$invalid && clientForm.activationDate.$error.validateServer" ng-bind="validation.activationDate"></span>
                            <span class="help-inline" ng-show="clientForm.activationDate.$dirty && clientForm.activationDate.$invalid && clientForm.activationDate.$error.pattern">Must be formatted as YYYY-MM-DD</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<div class="container">
    <div class="span12">
        <div class="widget-box">
            <div class="widget-title">
                <span class="widget-icon">
                    <i class="icon-user"></i>
                </span>
                <h3>Custom Fields</h3>
            </div>
            <div class="widget-content">
                <form name="newFieldForm">
                <table class="table table-admin-fields">
                    <tr>
                        <th>&nbsp;</th>
                        <th>Field Name</th>
                        <th>Type</th>
                        <th>Info</th>
                        <th><button class="btn" ng-click="showDeleted = !showDeleted"><i class="icon icon-eye-open"></i> {{ showDeleted && 'Hide' || 'Show' }} Deleted Fields</button></th>
                    </tr>
                    <tr ng-repeat="field in client.format" ng-show="!field.deleted || showDeleted == true">
                        <td class="order"><i class="icon icon-resize-vertical"></i></td>
                        <td>{{ field.name }}</td>
                        <td>{{ options.fieldTypes[field.type].name }}</td>
                        <td ng-switch on="field.type">
                            <span ng-switch-when="select">{{ field.data.options.length }} options</span>
                            <span ng-switch-when="select-severity">{{ field.data.options.length }} options</span>
                            <span ng-switch-when="select-impact">{{ field.data.options.length }} options</span>
                            <span ng-switch-default>&nbsp;</span>
                        </td>
                        <td>
                            <button ng-show="!field.deleted" class="btn btn-info" ng-click="editField( field._id )"><i class="icon icon-edit"></i> Edit</button>
                            <button ng-show="field.deleted" class="btn btn-warning" ng-click="field.deleted = false"><i class="icon icon-plus"></i> Restore</button>
                        </td>
                    </tr>
                    <tfoot>

                    <tr>
                        <td>&nbsp;</td>
                        <td>
                            <input type="text"
                                   placeholder="Name..."
                                   ng-model="newField.name"
                                   required />
                        </td>
                        <td>
                            <select id="input-newField-fieldType"
                                ng-model="newField.type"
                                name="newField-fieldType"
                                ng-options="option.alias as option.name for (key, option) in options.fieldTypes"
                                required>
                            </select>
                        </td>
                        <td>&nbsp;</td>
                        <td>
                            <button class="btn btn-primary" ng-click="addField()" ng-disabled="!newFieldForm.$valid"><i class="icon icon-plus"></i> Add</button>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                </form>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="span12">
            <div class="widget-box">
                <div class="widget-title">
                <span class="widget-icon">
                    <i class="icon-user"></i>
                </span>
                    <h3>Hierarchical Groups</h3>
                </div>
                <div class="widget-content">

                    <table class="table table-admin-fields">
                        <tr>
                            <th>&nbsp;</th>
                            <th>Group Name</th>
                            <th>Children</th>
                            <th><button class="btn" ng-click="showDeletedGroups = !showDeletedGroups"><i class="icon icon-eye-open"></i> {{ showDeletedGroups && 'Hide' || 'Show' }} Deleted Groups</button></th>
                        </tr>
                        <tr ng-repeat="group in client.attributes" ng-show="!group.deleted || showDeletedGroups">
                            <td class="order"><i class="icon icon-resize-vertical"></i></td>
                            <td>{{ group.name }}</td>
                            <td>{{ group.children.length }}</td>
                            <td>
                                <button ng-show="!group.deleted" class="btn btn-info" ng-click="editGroup( group._id )"><i class="icon icon-edit"></i> Edit</button>
                                <button ng-show="group.deleted" class="btn btn-warning" ng-click="group.deleted = false"><i class="icon icon-plus"></i> Restore</button>
                            </td>
                        </tr>
                        <tfoot>
                        <tr>
                            <td>&nbsp;</td>
                            <td>
                                <form name="newGroupForm">
                                <input type="text"
                                       placeholder="Name.."
                                       ng-model="newGroup.name"
                                       required />
                                </form>
                            </td>
                            <td>&nbsp;</td>
                            <td>
                                <button class="btn btn-primary" ng-click="addGroup()" ng-disabled="!newGroupForm.$valid"><i class="icon icon-plus"></i> Add</button>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">

            <!-- Save -->
            <div class="control-group">
                <div class="controls">
                    <button type="submit" class="btn btn-success"
                            ng-disabled="clientForm.$invalid">
                        <i class="icon icon-ok"></i>
                        Save Changes
                    </button>
                    <button type="button" class="btn btn-danger"
                            ng-click="deleteClient()"
                            ng-show="{{client.id.length && !client.deleted}}"
                            ng-confirm-click="Are you sure you want to delete this client? All users assigned to this client will be unable to access Preslog if you do this.">
                        <i class="icon icon-remove"></i>
                        Delete Client
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
